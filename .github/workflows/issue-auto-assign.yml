name: Issueè‡ªå‹•å®Ÿè£…ã‚¢ã‚µã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ 

on:
  issues:
    types: [opened, edited, labeled]

jobs:
  auto-assign-implementation:
    runs-on: ubuntu-latest
    
    steps:
    - name: è‡ªå‹•å®Ÿè£…ãŒå¿…è¦ã‹ãƒã‚§ãƒƒã‚¯
      id: check-implementation
      uses: actions/github-script@v7
      with:
        script: |
          const issue = context.payload.issue;
          const body = issue.body || '';
          const title = issue.title || '';
          
          // è‡ªå‹•å®Ÿè£…ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯
          const implementationKeywords = [
            'å®Ÿè£…ã—ã¦', 'ä½œã£ã¦', 'è¿½åŠ ã—ã¦', 'implement', 'create', 'add',
            'æ©Ÿèƒ½è¿½åŠ ', 'æ–°æ©Ÿèƒ½', 'feature', 'function'
          ];
          
          const needsImplementation = implementationKeywords.some(keyword => 
            title.toLowerCase().includes(keyword.toLowerCase()) || 
            body.toLowerCase().includes(keyword.toLowerCase())
          );
          
          console.log('è‡ªå‹•å®Ÿè£…ãŒå¿…è¦:', needsImplementation);
          return needsImplementation;
    
    - name: è‡ªå‹•å®Ÿè£…ãƒ©ãƒ™ãƒ«ã‚’è¿½åŠ 
      if: steps.check-implementation.outputs.result == 'true'
      uses: actions/github-script@v7
      with:
        script: |
          await github.rest.issues.addLabels({
            owner: context.repo.owner,
            repo: context.repo.repo,
            issue_number: context.issue.number,
            labels: ['auto-implement', 'claude-code-ready']
          });
    
    - name: å®Ÿè£…æ‰‹é †ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ 
      if: steps.check-implementation.outputs.result == 'true'
      uses: actions/github-script@v7
      with:
        script: |
          const comment = `ğŸ¤– **è‡ªå‹•å®Ÿè£…å¯¾è±¡ã®Issueã¨ã—ã¦æ¤œå‡ºã•ã‚Œã¾ã—ãŸï¼**
          
          ã“ã®Issueã¯è‡ªå‹•å®Ÿè£…ã®å¯¾è±¡ã¨ã—ã¦èªè­˜ã•ã‚Œã¾ã—ãŸã€‚
          
          ### å®Ÿè£…é–‹å§‹æ–¹æ³•
          
          **æ–¹æ³•1: è‡ªå‹•å®Ÿè£…ã‚’å³åº§ã«é–‹å§‹**
          - ã€ŒRun workflowã€ãƒœã‚¿ãƒ³ã‹ã‚‰ \`Auto Implementation with Claude Code\` ã‚’å®Ÿè¡Œ
          - ã“ã®Issueç•ªå·ã‚’å…¥åŠ›ã—ã¦å®Ÿè¡Œ
          
          **æ–¹æ³•2: æ‰‹å‹•ã§ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’èµ·å‹•**
          \`\`\`bash
          # GitHub CLIã‚’ä½¿ç”¨
          gh workflow run auto-implementation.yml -f issue_number=${{ github.event.issue.number }} -f implementation_type=feature
          \`\`\`
          
          ### å®Ÿè£…ãƒ—ãƒ­ã‚»ã‚¹
          1. ğŸ”„ è‡ªå‹•ã§ãƒ–ãƒ©ãƒ³ãƒä½œæˆ
          2. ğŸ“ å®Ÿè£…ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç”Ÿæˆ
          3. ğŸ§ª åŸºæœ¬ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
          4. ğŸ“‹ PRè‡ªå‹•ä½œæˆ
          5. ğŸ¤– Claude Codeã§ã®è©³ç´°å®Ÿè£…
          
          ### å®Ÿè£…ã‚¿ã‚¤ãƒ—
          - \`feature\`: æ–°æ©Ÿèƒ½è¿½åŠ 
          - \`bugfix\`: ãƒã‚°ä¿®æ­£
          - \`enhancement\`: æ©Ÿèƒ½å¼·åŒ–
          - \`refactor\`: ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
          
          ---
          *ğŸ¤– è‡ªå‹•æ¤œå‡ºã‚·ã‚¹ãƒ†ãƒ  - \`auto-implement\`ãƒ©ãƒ™ãƒ«ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸ*`;
          
          await github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: comment
          });
    
    - name: å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’ä½œæˆ
      if: steps.check-implementation.outputs.result == 'true'
      uses: actions/github-script@v7
      with:
        script: |
          const checklist = `
          
          ---
          
          ## ğŸ¤– è‡ªå‹•å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
          
          - [ ] è‡ªå‹•å®Ÿè£…ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œ
          - [ ] å®Ÿè£…ãƒ–ãƒ©ãƒ³ãƒä½œæˆ
          - [ ] åŸºæœ¬å®Ÿè£…å®Œäº†
          - [ ] PRä½œæˆ
          - [ ] Claude Codeã§ã®è©³ç´°å®Ÿè£…
          - [ ] ãƒ†ã‚¹ãƒˆè¿½åŠ 
          - [ ] ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼
          - [ ] ãƒãƒ¼ã‚¸
          
          ### é€²æ—çŠ¶æ³
          - **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸŸ¡ å®Ÿè£…å¾…æ©Ÿä¸­
          - **æ‹…å½“**: ğŸ¤– GitHub Actions + Claude Code
          - **äºˆå®šæ‰€è¦æ™‚é–“**: 10-30åˆ†
          
          *ã“ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã¯è‡ªå‹•çš„ã«æ›´æ–°ã•ã‚Œã¾ã™*`;
          
          // æ—¢å­˜ã®Issueãƒœãƒ‡ã‚£ã«è¿½åŠ 
          const currentBody = context.payload.issue.body || '';
          const updatedBody = currentBody + checklist;
          
          await github.rest.issues.update({
            owner: context.repo.owner,
            repo: context.repo.repo,
            issue_number: context.issue.number,
            body: updatedBody
          });